(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1179:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,8761,23)),Promise.resolve().then(r.bind(r,1933))},1933:(e,t,r)=>{"use strict";r.d(t,{IdentityChip:()=>b,KeyProvider:()=>h,U:()=>p});var n=r(4568),l=r(7620),a=r(9495);let o="identity",i="default",u="dupenet_pubkey";function s(){return new Promise((e,t)=>{let r=indexedDB.open("dupenet",1);r.onupgradeneeded=()=>{r.result.createObjectStore(o)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}async function c(){try{let e=await s();return new Promise((t,r)=>{let n=e.transaction(o,"readonly").objectStore(o).get(i);n.onsuccess=()=>{var e;return t(null!=(e=n.result)?e:null)},n.onerror=()=>r(n.error)})}catch(e){return null}}async function f(e,t,r){let n=await s();await new Promise((l,a)=>{let u=n.transaction(o,"readwrite").objectStore(o),s={privateKey:e,publicKey:t,publicKeyHex:r,createdAt:Date.now()},c=u.put(s,i);c.onsuccess=()=>l(),c.onerror=()=>a(c.error)});try{localStorage.setItem(u,r)}catch(e){}}async function y(){try{let e=await s();await new Promise((t,r)=>{let n=e.transaction(o,"readwrite").objectStore(o).delete(i);n.onsuccess=()=>t(),n.onerror=()=>r(n.error)})}catch(e){}try{localStorage.removeItem(u)}catch(e){}}let d=(0,l.createContext)({publicKeyHex:null,loading:!0,generate:async()=>{},getPrivateKey:async()=>null,clear:async()=>{}});function p(){return(0,l.useContext)(d)}function h(e){let{children:t}=e,[r,o]=(0,l.useState)(null),[i,u]=(0,l.useState)(!0);(0,l.useEffect)(()=>{c().then(e=>{e&&o(e.publicKeyHex),u(!1)})},[]);let s=(0,l.useCallback)(async()=>{let e=await (0,a.rn)(),t=(0,a.nj)(e.publicKey);await f(e.privateKey,e.publicKey,t),o(t)},[]),p=(0,l.useCallback)(async()=>{var e;let t=await c();return null!=(e=null==t?void 0:t.privateKey)?e:null},[]),h=(0,l.useCallback)(async()=>{await y(),o(null)},[]);return(0,n.jsx)(d.Provider,{value:{publicKeyHex:r,loading:i,generate:s,getPrivateKey:p,clear:h},children:t})}function b(){let{publicKeyHex:e,loading:t,generate:r,clear:l}=p();if(t)return(0,n.jsx)("span",{className:"t",children:"..."});if(!e)return(0,n.jsx)("button",{onClick:r,className:"link-btn",children:"[generate identity]"});let a=e.slice(0,4)+".."+e.slice(-4);return(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"t",title:e,children:a})," ",(0,n.jsx)("button",{onClick:l,className:"link-btn t",title:"clear identity",children:"x"})]})}},8761:()=>{},9495:(e,t,r)=>{"use strict";r.d(t,{DJ:()=>y,a2:()=>f,nj:()=>o,rn:()=>c});var n=r(3726),l=r(3761),a=r(4595);n.jn.sha512Sync=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=l.Zf.create();for(let e of t)n.update(e);return n.digest()};let o=a.My,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function u(e,t){let r=e<<5;if(t<24)return[r|t];if(t<256)return[24|r,t];if(t<65536)return[25|r,t>>8&255,255&t];if(t<0x100000000)return[26|r,t>>>24&255,t>>>16&255,t>>>8&255,255&t];let n=Math.floor(t/0x100000000),l=t>>>0;return[27|r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,l>>>24&255,l>>>16&255,l>>>8&255,255&l]}function s(e){return new Uint8Array(function e(t){if(null==t)return[246];if("boolean"==typeof t)return[t?245:244];if("number"==typeof t){if(!Number.isInteger(t)||t<0)throw Error("only non-negative integers supported");return u(0,t)}if("string"==typeof t){let e=new TextEncoder().encode(t);return[...u(3,e.length),...e]}if(t instanceof Uint8Array)return[...u(2,t.length),...t];if(Array.isArray(t)){let r=u(4,t.length);for(let n of t)r.push(...e(n));return r}if("object"==typeof t){let r=Object.keys(t).sort(),n=u(5,r.length);for(let l of r)n.push(...e(l)),n.push(...e(t[l]));return n}throw Error("unsupported CBOR type: ".concat(typeof t))}(e))}async function c(){let e=crypto.getRandomValues(new Uint8Array(32)),t=await (0,n.lG)(e);return{privateKey:e,publicKey:t}}async function f(e,t){let r=s({v:t.v,kind:t.kind,from:t.from,ref:t.ref,body:t.body,sats:t.sats,ts:t.ts}),l=await (0,n._S)(r,e);return{...t,sig:function(e){let t="";for(let l=0;l<e.length;l+=3){var r,n;let a=e[l],o=null!=(r=e[l+1])?r:0,u=null!=(n=e[l+2])?n:0;t+=i[a>>2],t+=i[(3&a)<<4|o>>4],l+1<e.length?t+=i[(15&o)<<2|u>>6]:t+="=",l+2<e.length?t+=i[63&u]:t+="="}return t}(l)}}function y(e){return o(s(e))}}},e=>{e.O(0,[950,70,587,18,358],()=>e(e.s=1179)),_N_E=e.O()}]);