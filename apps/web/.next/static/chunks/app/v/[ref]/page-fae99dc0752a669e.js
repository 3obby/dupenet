(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[409],{1933:(e,t,n)=>{"use strict";n.d(t,{IdentityChip:()=>p,KeyProvider:()=>m,U:()=>h});var r=n(4568),s=n(7620),a=n(9495);let i="identity",l="default",o="dupenet_pubkey";function c(){return new Promise((e,t)=>{let n=indexedDB.open("dupenet",1);n.onupgradeneeded=()=>{n.result.createObjectStore(i)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async function u(){try{let e=await c();return new Promise((t,n)=>{let r=e.transaction(i,"readonly").objectStore(i).get(l);r.onsuccess=()=>{var e;return t(null!=(e=r.result)?e:null)},r.onerror=()=>n(r.error)})}catch(e){return null}}async function d(e,t,n){let r=await c();await new Promise((s,a)=>{let o=r.transaction(i,"readwrite").objectStore(i),c={privateKey:e,publicKey:t,publicKeyHex:n,createdAt:Date.now()},u=o.put(c,l);u.onsuccess=()=>s(),u.onerror=()=>a(u.error)});try{localStorage.setItem(o,n)}catch(e){}}async function f(){try{let e=await c();await new Promise((t,n)=>{let r=e.transaction(i,"readwrite").objectStore(i).delete(l);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)})}catch(e){}try{localStorage.removeItem(o)}catch(e){}}let y=(0,s.createContext)({publicKeyHex:null,loading:!0,generate:async()=>{},getPrivateKey:async()=>null,clear:async()=>{}});function h(){return(0,s.useContext)(y)}function m(e){let{children:t}=e,[n,i]=(0,s.useState)(null),[l,o]=(0,s.useState)(!0);(0,s.useEffect)(()=>{u().then(e=>{e&&i(e.publicKeyHex),o(!1)})},[]);let c=(0,s.useCallback)(async()=>{let e=await (0,a.rn)(),t=(0,a.nj)(e.publicKey);await d(e.privateKey,e.publicKey,t),i(t)},[]),h=(0,s.useCallback)(async()=>{var e;let t=await u();return null!=(e=null==t?void 0:t.privateKey)?e:null},[]),m=(0,s.useCallback)(async()=>{await f(),i(null)},[]);return(0,r.jsx)(y.Provider,{value:{publicKeyHex:n,loading:l,generate:c,getPrivateKey:h,clear:m},children:t})}function p(){let{publicKeyHex:e,loading:t,generate:n,clear:s}=h();if(t)return(0,r.jsx)("span",{className:"t",children:"..."});if(!e)return(0,r.jsx)("button",{onClick:n,className:"link-btn",children:"[generate identity]"});let a=e.slice(0,4)+".."+e.slice(-4);return(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"t",title:e,children:a})," ",(0,r.jsx)("button",{onClick:s,className:"link-btn t",title:"clear identity",children:"x"})]})}},2490:(e,t,n)=>{"use strict";n.d(t,{_J:()=>s,hq:()=>a,tk:()=>i});var r=n(9495);async function s(e,t,n,s){return(0,r.a2)(n,{v:1,kind:1,from:s,ref:e,body:"",sats:t,ts:Date.now()})}async function a(e,t,n,s){let a=(0,r.DJ)({text:t});return(0,r.a2)(n,{v:1,kind:3,from:s,ref:e,body:a,sats:0,ts:Date.now()})}async function i(e){return(await fetch("/api/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}},7541:(e,t,n)=>{"use strict";var r=n(3041);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},8445:(e,t,n)=>{"use strict";n.d(t,{CommentBox:()=>o});var r=n(4568),s=n(7620),a=n(7541),i=n(1933),l=n(2490);function o(e){let{parentRef:t}=e,n=(0,a.useRouter)(),{publicKeyHex:o,generate:c,getPrivateKey:u}=(0,i.U)(),[d,f]=(0,s.useState)(""),[y,h]=(0,s.useState)("idle"),[m,p]=(0,s.useState)("");if(!o)return(0,r.jsx)("span",{className:"t",children:(0,r.jsx)("button",{onClick:c,className:"link-btn",children:"[create key to comment]"})});async function b(){let e=d.trim();if(e&&o){h("sending"),p("");try{let s=await u();if(!s){h("error"),p("key not found");return}let a=await (0,l.hq)(t,e,s,o),i=await (0,l.tk)(a);if(i.ok)h("sent"),f(""),setTimeout(()=>{h("idle"),n.refresh()},1e3);else{var r;h("error"),p(null!=(r=i.error)?r:"unknown error"),setTimeout(()=>h("idle"),3e3)}}catch(e){h("error"),p(String(e)),setTimeout(()=>h("idle"),3e3)}}}return"sending"===y?(0,r.jsx)("span",{className:"t",children:"posting..."}):"sent"===y?(0,r.jsx)("span",{children:"+ posted"}):"error"===y?(0,r.jsxs)("span",{children:["failed",m?": ".concat(m):""," —"," ",(0,r.jsx)("button",{onClick:()=>h("idle"),className:"link-btn",children:"retry"})]}):(0,r.jsxs)("div",{className:"comment-box",children:[(0,r.jsx)("textarea",{value:d,onChange:e=>f(e.target.value),placeholder:"comment...",rows:3,className:"comment-input"}),(0,r.jsx)("br",{}),(0,r.jsx)("button",{onClick:b,className:"link-btn",disabled:!d.trim(),children:"[post]"})]})}},9495:(e,t,n)=>{"use strict";n.d(t,{DJ:()=>f,a2:()=>d,nj:()=>i,rn:()=>u});var r=n(3726),s=n(3761),a=n(4595);r.jn.sha512Sync=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=s.Zf.create();for(let e of t)r.update(e);return r.digest()};let i=a.My,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function o(e,t){let n=e<<5;if(t<24)return[n|t];if(t<256)return[24|n,t];if(t<65536)return[25|n,t>>8&255,255&t];if(t<0x100000000)return[26|n,t>>>24&255,t>>>16&255,t>>>8&255,255&t];let r=Math.floor(t/0x100000000),s=t>>>0;return[27|n,r>>>24&255,r>>>16&255,r>>>8&255,255&r,s>>>24&255,s>>>16&255,s>>>8&255,255&s]}function c(e){return new Uint8Array(function e(t){if(null==t)return[246];if("boolean"==typeof t)return[t?245:244];if("number"==typeof t){if(!Number.isInteger(t)||t<0)throw Error("only non-negative integers supported");return o(0,t)}if("string"==typeof t){let e=new TextEncoder().encode(t);return[...o(3,e.length),...e]}if(t instanceof Uint8Array)return[...o(2,t.length),...t];if(Array.isArray(t)){let n=o(4,t.length);for(let r of t)n.push(...e(r));return n}if("object"==typeof t){let n=Object.keys(t).sort(),r=o(5,n.length);for(let s of n)r.push(...e(s)),r.push(...e(t[s]));return r}throw Error("unsupported CBOR type: ".concat(typeof t))}(e))}async function u(){let e=crypto.getRandomValues(new Uint8Array(32)),t=await (0,r.lG)(e);return{privateKey:e,publicKey:t}}async function d(e,t){let n=c({v:t.v,kind:t.kind,from:t.from,ref:t.ref,body:t.body,sats:t.sats,ts:t.ts}),s=await (0,r._S)(n,e);return{...t,sig:function(e){let t="";for(let s=0;s<e.length;s+=3){var n,r;let a=e[s],i=null!=(n=e[s+1])?n:0,o=null!=(r=e[s+2])?r:0;t+=l[a>>2],t+=l[(3&a)<<4|i>>4],s+1<e.length?t+=l[(15&i)<<2|o>>6]:t+="=",s+2<e.length?t+=l[63&o]:t+="="}return t}(s)}}function f(e){return i(c(e))}},9790:(e,t,n)=>{"use strict";n.d(t,{FortifyButton:()=>c});var r=n(4568),s=n(7620),a=n(7541),i=n(1933),l=n(2490);let o=[21,210,2100];function c(e){let{poolRef:t}=e,n=(0,a.useRouter)(),{publicKeyHex:c,generate:u,getPrivateKey:d}=(0,i.U)(),[f,y]=(0,s.useState)(!1),[h,m]=(0,s.useState)(""),[p,b]=(0,s.useState)("idle"),[k,x]=(0,s.useState)("");if(!c)return(0,r.jsxs)("span",{children:[(0,r.jsx)("button",{onClick:u,className:"link-btn",children:"[fortify]"})," ",(0,r.jsx)("span",{className:"t",children:"(create key first)"})]});async function j(e){if(!(e<=0)&&Number.isInteger(e)&&c){b("sending"),x("");try{let s=await d();if(!s){b("error"),x("key not found");return}let a=await (0,l._J)(t,e,s,c),i=await (0,l.tk)(a);if(i.ok)b("sent"),y(!1),setTimeout(()=>{b("idle"),n.refresh()},1500);else{var r;b("error"),x(null!=(r=i.error)?r:"unknown error"),setTimeout(()=>b("idle"),3e3)}}catch(e){b("error"),x(String(e)),setTimeout(()=>b("idle"),3e3)}}}return"sending"===p?(0,r.jsx)("span",{className:"t",children:"sending..."}):"sent"===p?(0,r.jsx)("span",{children:"+ funded"}):"error"===p?(0,r.jsxs)("span",{children:["failed",k?": ".concat(k):""," —"," ",(0,r.jsx)("button",{onClick:()=>b("idle"),className:"link-btn",children:"retry"})]}):f?(0,r.jsxs)("span",{className:"fortify-row",children:[o.map(e=>(0,r.jsx)("button",{onClick:()=>j(e),className:"link-btn",children:e},e))," ",(0,r.jsx)("input",{type:"number",min:"1",placeholder:"custom",value:h,onChange:e=>m(e.target.value),className:"inline-input",onKeyDown:e=>{"Enter"===e.key&&j(parseInt(h,10))}}),(0,r.jsx)("button",{onClick:()=>j(parseInt(h,10)),className:"link-btn",children:"go"})," ",(0,r.jsx)("span",{className:"t",children:"sat"})," ",(0,r.jsx)("button",{onClick:()=>y(!1),className:"link-btn t",children:"x"})]}):(0,r.jsx)("button",{onClick:()=>y(!0),className:"link-btn",children:"[fortify]"})}},9974:(e,t,n)=>{Promise.resolve().then(n.bind(n,8445)),Promise.resolve().then(n.bind(n,9790))}},e=>{e.O(0,[70,587,18,358],()=>e(e.s=9974)),_N_E=e.O()}]);